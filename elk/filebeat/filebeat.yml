filebeat.inputs:
- type: docker
  container_ids:
    - "nginx"
    - "postgres"
  fields_under_root: true

output.tcp:
  host: 'logstash:5044'
  port: 5044

logging.level: debug

filebeat.modules:
  - module: system
    period: 10s
    metricsets:
      - cpu
      - load
      - memory
      - network
      - process
      - socket_summary
    processes: ['.*']
    process.include_top_n: 
      by_cpu: 5
      by_memory: 5

  - module: nginx
    access:
      enabled: true
      var.paths: ["/var/log/nginx/access.log"]
    error:
      enabled: true
      var.paths: ["/var/log/nginx/error.log"]
      
  - module: postgresql
    log:
      enabled: true
      var.paths: ["/var/log/postgresql/*.log"]

processors:
  - add_docker_metadata:
    host: "unix:///var/run/docker.sock"
  - drop_event:
      when:
        not:
          has_fields: ["docker.container.id"]