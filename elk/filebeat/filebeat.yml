filebeat.inputs:
- type: docker
  container_ids:
    - "nginx"
    - "postgres"
  fields_under_root: true

output.logstash:
  host: ["logstash:5044"]
  ssl.certificate_authorities: ["/usr/share/filebeat/config/certs/ca.crt"]
  ssl.certificate: "/usr/share/filebeat/config/certs/filebeat.crt"          
  ssl.key: "/usr/share/filebeat/config/certs/filebeat.key"                  

logging.level: debug

filebeat.modules:
  - module: system
    period: 10s
    metricsets:
      - cpu
      - load
      - memory
      - network
      - process
      - socket_summary
    processes: ['.*']
    process.include_top_n: 
      by_cpu: 5
      by_memory: 5

  - module: nginx
    access:
      enabled: true
      var.paths: ["/var/log/nginx/access.log"]
    error:
      enabled: true
      var.paths: ["/var/log/nginx/error.log"]
      
  - module: postgresql
    log:
      enabled: true
      var.paths: ["/var/log/postgresql/*.log"]

processors:
  - add_docker_metadata:
      host: "unix:///var/run/docker.sock"
  - drop_event:
      when:
        not:
          has_fields: ["docker.container.id"]